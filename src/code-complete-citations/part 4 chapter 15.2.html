<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8"/>
		<link href="styles.css" rel="stylesheet"></link>
	</head>
	<body>
	Цитата из книги "Совершенный код" с комментариями. Автор: С.Макконнел
	<p>Купить всю книгу можно на следующих сайтах:
	<ul>
		<li>ozon.ru <a href="http://www.ozon.ru/context/detail/id/138437220/" target="_blank">(открыть в новой вкладке)</a></li>
		<li>market.yandex.ru <a href="https://market.yandex.ru/product--makkonnell-s-sovershennyi-kod-master-klass/1545077" target="_blank">(открыть в новой вкладке)</a></li>
	</ul>
	</p>
	<h3>Часть IV. Глава 15.2 Операторы case</h3>
<p>Оператор case или switch — конструкция, сильно варьирующаяся от языка к языку. C++ и Java поддерживают case только для порядковых типов, рассматривая по одному значению за раз. Visual Basic поддерживает case для порядковых типов и предоставляет мощные средства для обозначения диапазонов и комбинаций значений. Многие языки сценариев вообще не поддерживают case.</p>
<p>Следующие разделы представляют основные принципы эффективного использования операторов case.</p>
<h4>Выбор наиболее эффективного порядка вариантов</h4>
<p>Организовать порядок следования вариантов в операторе case можно по-разному. Если выражение case невелико и содержит только три варианта и три соответствующих строки кода, то выбранный порядок большого значения не имеет. Однако в случае длинного оператора case (скажем, обрабатывающего десятки различных событий в программе, управляемой событиями) порядок следования достаточно важен. Давайте рассмотрим способы упорядочения.</p>
<p><b>Упорядочивайте варианты по алфавиту или численно</b> Если все варианты равнозначны, их размещение в алфавитном порядке улучшает читабельность. В этом случае нужный вариант легко выбрать из группы.</p>
<p><b>Поместите правильный вариант первым</b> Если у вас есть один корректный вариант и несколько исключений, поместите правильное значение первым. Отметьте в комментариях, что этот вариант является нормальным, а все остальные — исключительными.</p>
<p><b>Отсортируйте варианты по частоте</b> Поместите наиболее часто встречающиеся случаи в начало, а более редкие — в конец списка. Этот подход имеет два преимущества. Первое: читатели легко обнаружат ситуации, встречающиеся чаще всего. Второе: при сканировании списка в поисках определенных значений скорее всего будут требоваться наиболее часто встречающиеся варианты, поэтому их размещение в начале кода сделает поиск быстрее.</p>
<h4>Советы по использованию операторов case</h4>
<p>Далее перечислены советы по применению операторов case.</p>
<p><b>Сделайте обработку каждого варианта простой</b> Код, связанный с каждым вариантом, должен быть коротким. Краткость позволяет сделать структуру оператора case прозрачнее. Если действия, предпринимаемые для какого-то варианта слишком сложны, напишите метод и вызывайте его, а не размещайте весь этот код прямо в блоке case.</p>
<p><b>Не конструируйте искусственные переменные с целью получить возможность использовать оператор case</b> Оператор case следует применять для простых данных, которые легко разбить на категории. Если ваши данные нельзя назвать простыми, используйте цепочки if-then-else. Фальшивые переменные сбивают с толки, и их следует избегать. Например, не делайте так:</p>
<p>Пример создания искусственной переменной для оператора case — плохая практика (Java)</p>
<p class="preformatted">action = userCommand[ 0 ];
switch ( action ) {
    case 'c':
        Copy();
    break;
        case 'd':
        DeleteCharacter();
    break;
        case 'f':
        Format();
    break;
        case 'h':
        Help();
    break;
        ...
    default:
        HandleUserInputError( ErrorType.InvalidUserCommand );
}</p>
<p>Переменная action управляет оператором case. В данном случае action конструируется с помощью первого символа строки userCommand, которая вводится пользователем.</p>
<p>Этот потенциально опасный код может привести к проблемам. Вообще, если вы фабрикуете специальную переменную для case, реальные данные могут не вписываться в данное выражение так, как вы это себе представляете. В приведенном примере, если пользователь набирает copy, в операторе case отрезается первый символ «c», и корректно вызывается метод Copy(). С другой стороны, если пользователь набирает cement overshoes, clambake или cellulite, case точно также отрежет символ «c» и вызовет Copy(). Проверка ошибочных команд в блоке else оператора case не будет нормально функционировать, так как будет обрабатывать только неправильные первые буквы, а не команды целиком.</p>
<p>Вместо создания искусственной переменной в этом коде лучше использовать последовательность if-then-else-if и проверять целую строку. Вот как эффективно переписать код:</p>
<p>Пример использования операторов if-then-else вместо искусственной переменной для оператора case — хорошая практика (Java)</p>
<p class="preformatted">if ( UserCommand.equals( COMMAND_STRING_COPY ) ) {
    Copy();
}
else if ( UserCommand.equals( COMMAND_STRING_DELETE ) ) {
    DeleteCharacter();
}
else if ( UserCommand.equals( COMMAND_STRING_FORMAT ) ) {
    Format();
}
else if ( UserCommand.equals( COMMAND_STRING_HELP ) ) {
    Help();
}
...
else {
    HandleUserInputError( ErrorType_InvalidCommandInput );
}</p>
<p><b>Используйте вариант по умолчанию только для обработки настоящих значений по умолчанию</b> Порой, когда остается единственный вариант, вы решаете закодировать его как вариант по умолчанию. Заманчиво, но... неразумно: вы лишаетесь автоматического документирования, предоставляемого метками оператора case, и теряете возможность определения ошибок с помощью варианта по умолчанию.</p>
<p>Такие операторы case подвержены ошибкам при модификации. Если вы используете настоящее значение по умолчанию, то добавление нового варианта тривиально: вы просто дописываете новую метку и соответствующий код. Если же значение по умолчанию искусственно, провести изменения сложнее. Вам придется добавить новый вариант, возможно, сделав его новым умолчанием, а затем поменять прежний вариант по умолчанию так, чтобы он стал обычным вариантом. Поэтому изначально используйте только настоящие значения по умолчанию.</p>
<p><b>Используйте вариант по умолчанию для выявления ошибок</b> Если вариант по умолчанию в операторе case не используется и не планируется для иных действий, разместите в нем диагностическое сообщение:</p>
<p>Пример использования варианта по умолчанию для выявления ошибок — хорошая практика (Java)</p>
<p class="preformatted">switch ( commandShortcutLetter ) {
    case 'a':
        PrintAnnualReport();
        break;
    case 'p':
        // Никаких действий не требуется, но этот вариант предусмотрен.
        break;
    case 'q':
        PrintQuarterlyReport();
        break;
    case 's':
        PrintSummaryReport();
        break;
    default:
        DisplayInternalError( "Internal Error 905: Call customer support." );
}</p>
<p>Такие сообщения полезны и в отладочном, и в промышленном коде. Большинство пользователей предпочитают сообщения вроде «Внутренняя ошибка: Пожалуйста, позвоните в службу поддержки» отказу системы или, что еще хуже, немного неверным результатам, которые выглядят вполне нормально до того, как их проверит начальник.</p>
<p>Если вариант по умолчанию служит не для выявления ошибок, а для иных целей, то подразумевается, что любой выбор будет корректным. Дважды проверьте ваш код и убедитесь, что любое возможное значение на входе оператора case будет допустимо. Если обнаружится какой-то некорректный вариант, перепишите выражения, чтобы условие по умолчанию проверяло ошибки.</p>
<p><b>В C++ и Java старайтесь не писать код, проваливающийся сквозь блоки
оператора case</b> C-подобные языки (C, C++ и Java) не выполняют выход из блока case автоматически. Вместо этого вы должны явно закодировать конец блока. Если этого не сделать, программа провалится сквозь этот блок и начнет выполнять следующий. Это иногда приводит к некоторым вопиющим способам программирования, включая следующий пример:</p>
<p>Пример неправильного использования оператора case (C++)</p>
<p class="preformatted">switch ( InputVar ) {
    case 'A': if ( test ) {
                  // оператор 1
                  // оператор 2
    case 'B':     // оператор 3
                  // оператор 4
                  ...
              }
              ...
          break;
    ...
}</p>
<p>Этот способ плох, так как приводит к перемешиванию управляющих конструкций. Разобраться во вложенных управляющих конструкциях довольно тяжело, а в перекрывающихся — практически невозможно. Модификация вариантов 'A' или 'B' будет посложнее хирургической операции на головном мозге, и вполне вероятно, что их придется полностью переписать, чтобы получить работоспособную версию. Что вы и можете сделать с самого начала. В общем, лучше избегать сквозного перехода в блоках оператора case</p>
<p>В C++ ясно и безошибочно обозначайте код, проваливающийся сквозь блоки оператора case Если вы намеренно написали код, который должен выполняться в нескольких блоках case подряд, внятно прокомментируйте место, где это происходит, и объясните, почему это должно быть закодировано таким способом:</p>
<p>Пример документирования сквозного выполнения блоков case (C++)</p>
<p class="preformatted">switch ( errorDocumentationLevel ) {
    case DocumentationLevel_Full:
        DisplayErrorDetails( errorNumber );
        // СКВОЗНОЙ ПЕРЕХОД — Полная документация также печатает
        // суммарные комментарии.
    case DocumentationLevel_Summary:
        DisplayErrorSummary( errorNumber );
        // СКВОЗНОЙ ПЕРЕХОД — Суммарная документация
        // также печатает номер ошибки.
    case DocumentationLevel_NumberOnly:
        DisplayErrorNumber( errorNumber );
        break;
    default:
        DisplayInternalError( "Internal Error 905: Call customer support." );
}
<p>Эта методика встречается так же часто, как и люди, которые предпочитают подержанный «Понтиак Ацтек» новенькому «Корвету». Обычно код, переходящий сквозь один блок case к другому, просто напрашивается на ошибки при модификации и его следует избегать.</p>
	</body>
</html>